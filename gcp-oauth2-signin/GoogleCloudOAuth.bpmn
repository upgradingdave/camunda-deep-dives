<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_0uwmzbl" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.7.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.1.0">
  <bpmn:process id="Process_gcpOAuth2" name="Google Cloud OAuth2" isExecutable="true">
    <bpmn:extensionElements>
      <zeebe:userTaskForm id="userTaskForm_1tk6g28">{
  "components": [
    {
      "text": "## Sign into Google\n\nThis app will make API requests to Google Cloud on your behalf. Copy and paste the link below in your browser. \n\nSign into Google and click **Allow**.  Then copy and paste your **Authorization Code** below. \n\n",
      "type": "text",
      "id": "Field_1sc8kbb",
      "properties": {}
    },
    {
      "type": "textfield",
      "id": "Field_0tfl5pn",
      "key": "field_oauthUrl",
      "disabled": true
    },
    {
      "label": "Authorization Code",
      "type": "textfield",
      "id": "Field_165uco1",
      "key": "field_authorizationCode",
      "description": "Copy and paste Authorization Code Here",
      "validate": {
        "minLength": 5
      }
    }
  ],
  "type": "default",
  "id": "Form_signinWithGoogle",
  "executionPlatform": "Camunda Cloud",
  "executionPlatformVersion": "8.1.0",
  "exporter": {
    "name": "Camunda Modeler",
    "version": "5.7.0"
  },
  "schemaVersion": 6
}</zeebe:userTaskForm>
    </bpmn:extensionElements>
    <bpmn:startEvent id="StartEvent_1">
      <bpmn:outgoing>Flow_06uw7n7</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_06uw7n7" sourceRef="StartEvent_1" targetRef="Gateway_0helzct" />
    <bpmn:endEvent id="Event_0tw8lkr">
      <bpmn:incoming>Flow_09z00gq</bpmn:incoming>
      <bpmn:incoming>Flow_1h1x7u3</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_09z00gq" sourceRef="Activity_0ksrt7v" targetRef="Event_0tw8lkr" />
    <bpmn:exclusiveGateway id="Gateway_1jfx6bj" name="Refresh Token Available?" default="Flow_1z0u4hv">
      <bpmn:incoming>Flow_0sqq391</bpmn:incoming>
      <bpmn:outgoing>Flow_1z0u4hv</bpmn:outgoing>
      <bpmn:outgoing>Flow_0s7og2b</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1z0u4hv" name="Yes" sourceRef="Gateway_1jfx6bj" targetRef="Activity_0ksrt7v" />
    <bpmn:sequenceFlow id="Flow_0s7og2b" name="No" sourceRef="Gateway_1jfx6bj" targetRef="Activity_1r2e7iz">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=gcpRefreshToken = null</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Activity_1r2e7iz" name="Sign into Google">
      <bpmn:extensionElements>
        <zeebe:formDefinition formKey="camunda-forms:bpmn:userTaskForm_1tk6g28" />
        <zeebe:ioMapping>
          <zeebe:input source="=&#34;https://accounts.google.com/o/oauth2/v2/auth?client_id=&#34;+gcpClientId+&#34;&#38;redirect_uri=urn:ietf:wg:oauth:2.0:oob&#38;response_type=code&#38;scope=https://www.googleapis.com/auth/cloud-platform&#34;" target="field_oauthUrl" />
          <zeebe:output source="=field_authorizationCode" target="gcpAuthorizationToken" />
        </zeebe:ioMapping>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0s7og2b</bpmn:incoming>
      <bpmn:outgoing>Flow_17w7xe7</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_17w7xe7" sourceRef="Activity_1r2e7iz" targetRef="Activity_1pk72s7" />
    <bpmn:serviceTask id="Activity_1pk72s7" name="Exchange Authorization Token" zeebe:modelerTemplate="io.camunda.connectors.HttpJson.v2" zeebe:modelerTemplateIcon="data:image/svg+xml;utf8,%3Csvg%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2018%2018%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M17.0335%208.99997C17.0335%2013.4475%2013.4281%2017.0529%208.98065%2017.0529C4.53316%2017.0529%200.927765%2013.4475%200.927765%208.99997C0.927765%204.55248%204.53316%200.947083%208.98065%200.947083C13.4281%200.947083%2017.0335%204.55248%2017.0335%208.99997Z%22%20fill%3D%22%23505562%22%2F%3E%0A%3Cpath%20d%3D%22M4.93126%2014.1571L6.78106%203.71471H10.1375C11.1917%203.71471%2011.9824%203.98323%2012.5095%204.52027C13.0465%205.04736%2013.315%205.73358%2013.315%206.57892C13.315%207.44414%2013.0714%208.15522%2012.5841%208.71215C12.1067%209.25913%2011.4553%209.63705%2010.6298%209.8459L12.0619%2014.1571H10.3315L9.03364%2010.0249H7.24351L6.51254%2014.1571H4.93126ZM7.49711%208.59281H9.24248C9.99832%208.59281%2010.5901%208.42374%2011.0177%208.08561C11.4553%207.73753%2011.6741%207.26513%2011.6741%206.66842C11.6741%206.19106%2011.5249%205.81811%2011.2265%205.54959C10.9282%205.27113%2010.4558%205.1319%209.80936%205.1319H8.10874L7.49711%208.59281Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E%0A">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:http-json:1" />
        <zeebe:ioMapping>
          <zeebe:input source="noAuth" target="authentication.type" />
          <zeebe:input source="20" target="connectionTimeoutInSeconds" />
          <zeebe:input source="post" target="method" />
          <zeebe:input source="https://accounts.google.com/o/oauth2/token" target="url" />
          <zeebe:input source="={&#10;  &#34;code&#34;: gcpAuthorizationToken,&#10;  &#34;client_id&#34;: gcpClientId,&#10;  &#34;client_secret&#34;: gcpClientSecret,&#10;  &#34;redirect_uri&#34;: &#34;urn:ietf:wg:oauth:2.0:oob&#34;,&#10;  &#34;grant_type&#34;: &#34;authorization_code&#34;&#10;}" target="body" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="resultVariable" value="gcpAccessTokenResponse" />
          <zeebe:header key="resultExpression" value="={&#10;  &#34;gcpAccessToken&#34;: response.body.access_token,&#10;  &#34;gcpRefreshToken&#34;: response.body.refresh_token&#10;}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_17w7xe7</bpmn:incoming>
      <bpmn:outgoing>Flow_1h1x7u3</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0helzct" name="Bearer Access Token?" default="Flow_1z0ttul">
      <bpmn:incoming>Flow_06uw7n7</bpmn:incoming>
      <bpmn:outgoing>Flow_0sqq391</bpmn:outgoing>
      <bpmn:outgoing>Flow_1z0ttul</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_0sqq391" name="No" sourceRef="Gateway_0helzct" targetRef="Gateway_1jfx6bj">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=gcpAccessToken = null</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="Event_0rhrb80">
      <bpmn:incoming>Flow_1z0ttul</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1z0ttul" name="Yes" sourceRef="Gateway_0helzct" targetRef="Event_0rhrb80" />
    <bpmn:serviceTask id="Activity_0ksrt7v" name="Exchange Refresh Token" zeebe:modelerTemplate="io.camunda.connectors.HttpJson.v2" zeebe:modelerTemplateIcon="data:image/svg+xml;utf8,%3Csvg%20width%3D%2218%22%20height%3D%2218%22%20viewBox%3D%220%200%2018%2018%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M17.0335%208.99997C17.0335%2013.4475%2013.4281%2017.0529%208.98065%2017.0529C4.53316%2017.0529%200.927765%2013.4475%200.927765%208.99997C0.927765%204.55248%204.53316%200.947083%208.98065%200.947083C13.4281%200.947083%2017.0335%204.55248%2017.0335%208.99997Z%22%20fill%3D%22%23505562%22%2F%3E%0A%3Cpath%20d%3D%22M4.93126%2014.1571L6.78106%203.71471H10.1375C11.1917%203.71471%2011.9824%203.98323%2012.5095%204.52027C13.0465%205.04736%2013.315%205.73358%2013.315%206.57892C13.315%207.44414%2013.0714%208.15522%2012.5841%208.71215C12.1067%209.25913%2011.4553%209.63705%2010.6298%209.8459L12.0619%2014.1571H10.3315L9.03364%2010.0249H7.24351L6.51254%2014.1571H4.93126ZM7.49711%208.59281H9.24248C9.99832%208.59281%2010.5901%208.42374%2011.0177%208.08561C11.4553%207.73753%2011.6741%207.26513%2011.6741%206.66842C11.6741%206.19106%2011.5249%205.81811%2011.2265%205.54959C10.9282%205.27113%2010.4558%205.1319%209.80936%205.1319H8.10874L7.49711%208.59281Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E%0A">
      <bpmn:extensionElements>
        <zeebe:ioMapping>
          <zeebe:input source="noAuth" target="authentication.type" />
          <zeebe:input source="20" target="connectionTimeoutInSeconds" />
          <zeebe:input source="https://accounts.google.com/o/oauth2/token" target="url" />
          <zeebe:input source="post" target="method" />
          <zeebe:input source="={&#10;  &#34;refresh_token&#34;: gcpRefreshToken,&#10;  &#34;client_id&#34;: gcpClientId,&#10;  &#34;client_secret&#34;: gcpClientSecret,&#10;  &#34;redirect_uri&#34;: &#34;urn:ietf:wg:oauth:2.0:oob&#34;,&#10;  &#34;grant_type&#34;: &#34;refresh_token&#34;&#10;}" target="body" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="resultVariable" value="gcpAccessTokenResponse" />
          <zeebe:header key="resultExpression" value="={&#10;  &#34;gcpAccessToken&#34;: response.body.access_token&#10;}" />
        </zeebe:taskHeaders>
        <zeebe:taskDefinition type="io.camunda:http-json:1" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1z0u4hv</bpmn:incoming>
      <bpmn:outgoing>Flow_09z00gq</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1h1x7u3" sourceRef="Activity_1pk72s7" targetRef="Event_0tw8lkr" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_gcpOAuth2">
      <bpmndi:BPMNShape id="Gateway_0helzct_di" bpmnElement="Gateway_0helzct" isMarkerVisible="true">
        <dc:Bounds x="265" y="122" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="254" y="86.5" width="71" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0rhrb80_di" bpmnElement="Event_0rhrb80">
        <dc:Bounds x="272" y="252" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="152" y="129" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1jfx6bj_di" bpmnElement="Gateway_1jfx6bj" isMarkerVisible="true">
        <dc:Bounds x="395" y="122" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="384" y="86" width="71" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0q7r1ib_di" bpmnElement="Activity_1r2e7iz">
        <dc:Bounds x="370" y="230" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1l84uju_di" bpmnElement="Activity_1pk72s7">
        <dc:Bounds x="550" y="230" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_02ir7az_di" bpmnElement="Activity_0ksrt7v">
        <dc:Bounds x="550" y="107" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0tw8lkr_di" bpmnElement="Event_0tw8lkr">
        <dc:Bounds x="702" y="192" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_06uw7n7_di" bpmnElement="Flow_06uw7n7">
        <di:waypoint x="188" y="147" />
        <di:waypoint x="265" y="147" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0sqq391_di" bpmnElement="Flow_0sqq391">
        <di:waypoint x="315" y="147" />
        <di:waypoint x="395" y="147" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="348" y="129" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1z0ttul_di" bpmnElement="Flow_1z0ttul">
        <di:waypoint x="290" y="172" />
        <di:waypoint x="290" y="252" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="296" y="209" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1z0u4hv_di" bpmnElement="Flow_1z0u4hv">
        <di:waypoint x="445" y="147" />
        <di:waypoint x="550" y="147" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="491" y="129" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0s7og2b_di" bpmnElement="Flow_0s7og2b">
        <di:waypoint x="420" y="172" />
        <di:waypoint x="420" y="230" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="429" y="197" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_17w7xe7_di" bpmnElement="Flow_17w7xe7">
        <di:waypoint x="470" y="270" />
        <di:waypoint x="550" y="270" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_09z00gq_di" bpmnElement="Flow_09z00gq">
        <di:waypoint x="650" y="147" />
        <di:waypoint x="720" y="147" />
        <di:waypoint x="720" y="192" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1h1x7u3_di" bpmnElement="Flow_1h1x7u3">
        <di:waypoint x="650" y="270" />
        <di:waypoint x="720" y="270" />
        <di:waypoint x="720" y="228" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
